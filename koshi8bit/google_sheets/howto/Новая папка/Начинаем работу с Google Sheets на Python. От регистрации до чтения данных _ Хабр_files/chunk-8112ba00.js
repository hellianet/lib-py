(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8112ba00"],{"084a":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tm-comments"},[n("div",{staticClass:"tm-comments__wrapper"},[n("header",{staticClass:"tm-comments__header"},[n("h2",{staticClass:"tm-comments__title"},[t._v("\n        "+t._s(t.msg("ARTICLE_COMMENTS_TITLE"))+"\n        "),t.commentsCount?n("span",{staticClass:"tm-comments__comments-count"},[t._v("\n          "+t._s(t.commentsCount)+"\n        ")]):t._e()]),t.$slots.headerAside?n("div",{staticClass:"tm-comments__header-aside"},[t._t("headerAside")],2):t._e()]),n("div",{staticClass:"tm-comments__inner"},[t.isLoading?n("TMPlaceholder",{attrs:{times:3,type:"comment"}}):[t._t("body"),t.comments.length?[n("div",{ref:"commentsList",staticClass:"tm-comments__tree"},[n("TMCommentThread",{attrs:{"comment-component":t.commentComponent,comments:t.comments,"complaint-action":t.complaintAction,"favorite-action":t.favoriteAction,"get-comment-link":t.getCommentLink,"in-storage":t.inStorage,"vote-action":t.voteAction},on:{addToStorage:function(e){return t.$emit("addToStorage",e)},commentDelete:function(e){return t.$emit("commentDelete",e)},commentSubmit:function(e){return t.$emit("commentSubmit",e)},deleteFromStorage:function(e){return t.$emit("deleteFromStorage",e)}}})],1)]:n("TMEmptyPlaceholder",[n("span",{domProps:{innerHTML:t._s(t.msg("COMMENT_EMPTY"))}})]),t._t("afterComments")]],2)]),t.rootCommentingEnabled&&!t.isLoading?[t.notice?n("TMNotice",{staticClass:"tm-comments__comment-notice",attrs:{type:t.notice.type}},[n("span",{domProps:{innerHTML:t._s(t.notice.message)}})]):n("TMCommentForm",{attrs:{"is-processing":t.isProcessingForm,label:t.msg("COMMENT_BASE_FORM_TITLE"),readonly:t.isProcessingForm},on:{submit:function(e){return t.$emit("commentSubmit",{value:e})}}})]:t._e()],2)},r=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(t.useNewWYSIWYG?"div":"form",{ref:"form",tag:"component",staticClass:"tm-comment-form",class:{"tm-comment-form_processing":t.isProcessing},on:{submit:function(e){return e.preventDefault(),t.submitForm.apply(null,arguments)}}},[n("div",{staticClass:"tm-comment-form__field"},[t.label?n("label",{ref:"label",staticClass:"tm-comment-form__label",domProps:{innerHTML:t._s(t.label)}}):t._e(),t.useNewWYSIWYG?n("div",{directives:[{name:"hotkey",rawName:"v-hotkey.stop",value:{c:t.scrollToCommentFormAndFocus},expression:"{ 'c': scrollToCommentFormAndFocus }",modifiers:{stop:!0}}],staticClass:"tm-comment-form__editor",on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.submitForm.apply(null,arguments):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.metaKey?t.submitForm.apply(null,arguments):null}]}},[t.renderEditor?n("WYSIWYG",{ref:"textarea",attrs:{"is-mobile":t.isMobile,lang:t.langOptions.hl,"props-config":t.WYSIWYGInitialProps,"use-test-ids":t.useTestIds},on:{loading:t.setFormLoading,update:t.onWYSIWYGUpdate}}):t._e()],1):n("textarea",t._g(t._b({directives:[{name:"hotkey",rawName:"v-hotkey.stop",value:{c:t.scrollToCommentFormAndFocus},expression:"{ 'c': scrollToCommentFormAndFocus }",modifiers:{stop:!0}}],ref:"textarea",staticClass:"tm-comment-form__textarea",on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.submit.apply(null,arguments):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.metaKey?t.submit.apply(null,arguments):null}]}},"textarea",t.$attrs,!1),t.inputListeners))]),n("div",{staticClass:"tm-comment-form__controls"},[t.useNewWYSIWYG?t._e():n("button",{ref:"previewButton",staticClass:"tm-comment-form__button tm-comment-form__button_preview",attrs:{disabled:t.isTextareaEmpty||t.isProcessing,type:"button"},on:{click:t.showPreview}},[t._v("\n      "+t._s(t.msg("COMMENT_ACTION_PREVIEW"))+"\n    ")]),n("button",{ref:"submitButton",staticClass:"tm-comment-form__button tm-comment-form__button_send",attrs:{disabled:t.isTextareaEmpty||t.WYSIWYGLoading||t.isProcessing},on:{click:t.submitForm}},[t._v("\n      "+t._s(t.msg("COMMENT_ACTION_SEND"))+"\n    ")]),t.isSuperAdmin&&t.showDelete?n("button",{ref:"suspendButton",staticClass:"tm-comment-form__button tm-comment-form__button_delete",attrs:{disabled:t.isTextareaEmpty||t.isProcessing,type:"button"},on:{click:t.suspendComment}},[t._v("\n      "+t._s(t.msg("COMMENT_ACTION_SUSPEND"))+"\n    ")]):t._e(),t.countdownTimer?n("span",{ref:"countdownTimer",staticClass:"tm-comment-form__countdown-timer"},[t._v("\n      "+t._s(t.formattedCountdownTimer)+"\n    ")]):t._e()])])},m=[],s=n("2b0e"),a=n("2f62"),c=n("09f4");function l(t){var e=Math.floor(parseInt(t,10)/3600),n=Math.floor(parseInt(t,10)/60)%60,o=Math.floor(parseInt(t,10))%60,r=function(t){var e=t>9?t:"0".concat(t);return e};return"".concat(r(e),":").concat(r(n),":").concat(r(o))}var u=n("4dcc"),p=n("c551");function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}s["default"].component("WYSIWYG",(function(){return n.e("chunk-2d0e907e").then(n.t.bind(null,"8c96",7))}));var b={name:"TMCommentForm",inheritAttrs:!1,props:{isProcessing:Boolean,countdownTimer:{type:Number,default:null},label:{type:String,default:null},showDelete:Boolean,initialData:{type:String,default:null}},data:function(){return{renderEditor:!1,WYSIWYGInitialProps:{embedHost:"https://embedd.srv.habr.com",imagesHost:Object(u["a"])("publication/upload","v2"),mentionHost:Object(u["a"])("publication/suggest-mention","v2"),imagesByUrlHost:Object(u["a"])("publication/upload-url","v2"),extensions:[],initialJSON:this.initialData,autoFocus:!1},WYSIWYGData:{},WYSIWYGLoading:!1}},computed:f(f(f(f({},Object(a["c"])("me",["isSuperAdmin"])),Object(a["c"])("i18n",["langOptions"])),Object(a["c"])("global",["isMobile"])),{},{useTestIds:function(){return!1},inputListeners:function(){var t=this;return f(f({},this.$listeners),{},{input:function(e){t.$emit("input",e.target.value)}})},isTextareaEmpty:function(){if(this.useNewWYSIWYG){var t=this.WYSIWYGData.json&&this.WYSIWYGData.json.content.filter((function(t){return"paragraph"!==t.type})).length,e=this.WYSIWYGData.textContent;return!t&&!e}return!this.$attrs.value},formattedCountdownTimer:function(){return l(this.countdownTimer)},useNewWYSIWYG:function(){return!0}}),mounted:function(){var t=this;this.useNewWYSIWYG?Object(p["f"])().then((function(e){var n=e.wysiwygRuleRefs.postComment;t.WYSIWYGInitialProps.extensions=n.elements,t.WYSIWYGInitialProps.autoFocus=!!t.$attrs.autofocus,t.renderEditor=!0})):this.$attrs.autofocus&&this.$refs.textarea.focus(),window.addEventListener("beforeunload",this.handlePageLeave)},beforeDestroy:function(){window.removeEventListener("beforeunload",this.handlePageLeave)},methods:{onWYSIWYGUpdate:function(t){this.WYSIWYGData=t},setFormLoading:function(t){this.WYSIWYGLoading=t},handlePageLeave:function(t){if(!this.isTextareaEmpty)return t.preventDefault(),t.returnValue="",!0},showPreview:function(){this.$emit("preview",this.$attrs.value)},suspendComment:function(){var t=window.confirm(this.msg("COMMENT_ACTION_SUSPEND_CONFIRM"));t&&this.$emit("delete",this.$attrs.value)},submitForm:function(){var t=this;this.useNewWYSIWYG?this.$emit("submit",{source:JSON.stringify(this.WYSIWYGData.json),editorVersion:2,done:function(){t.$emit("close"),t.renderEditor=!1,t.WYSIWYGData={},t.$nextTick((function(){t.renderEditor=!0}))}}):this.$emit("submit",this.$attrs.value)},scrollToCommentFormAndFocus:function(t){t.preventDefault(),Object(c["b"])(this.$refs.textarea.$el),this.useNewWYSIWYG?this.$el.querySelector(".ProseMirror").focus():this.$refs.textarea.focus()}}},C=b,_=(n("3fbf"),n("2877")),g=Object(_["a"])(C,i,m,!1,null,null,null),v=g.exports,y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tm-comment-thread"},[t._l(t.wrappedComments,(function(e){return n("TMCommentThreadFunctional",{key:e.comment.id,attrs:{"comment-component":t.commentComponent,"comment-wrapper":e,"favorite-action":t.favoriteAction,"first-unread-id":t.firstUnreadId,"in-storage":t.inStorage,msg:t.msg,"placeholder-text":t.msg("COMMENT_PLACEHOLDER_EMPTY"),"vote-action":t.voteAction},on:{moderate:t.moderateReadAndComment,openPopup:t.openPopup,showComplaintForm:t.showComplaintForm,showReplyForm:t.showReplyForm,toggleCollapse:t.toggleCollapse},scopedSlots:t._u([{key:"body",fn:function(e){var o=e.commentWrapper;return[t.getShouldShowComplaintForm(o)?n("div",{staticClass:"tm-comment-thread__reply-form"},[t.getPreviewComment?n("TMComment",{staticClass:"tm-comment-thread__reply-preview",attrs:{comment:t.getPreviewComment}}):t._e(),n("div",{staticClass:"tm-comment-thread__reply-form-wrapper"},[n("button",{staticClass:"tm-comment-thread__close-button",attrs:{title:t.msg("CLOSE")},on:{click:function(e){return t.hideComplaintForm(o)}}},[n("TMSvgImg",{attrs:{id:"close",size:12}})],1),n("TMComplaintForm",{attrs:{autofocus:"true","is-processing":t.isProcessingComplaintForm,label:t.msg("COMMENT_COMPLAINT_TITLE")},on:{submit:function(e){return t.onComplaintSend({value:e,parentId:o.comment.id})}},model:{value:t.complaintFormValue,callback:function(e){t.complaintFormValue=e},expression:"complaintFormValue"}})],1)],1):t._e(),t.getShouldShowCommentForm(o)?n("div",{staticClass:"tm-comment-thread__reply-form"},[n("div",{staticClass:"tm-comment-thread__reply-form-wrapper"},[n("button",{staticClass:"tm-comment-thread__close-button",attrs:{title:t.msg("CLOSE")},on:{click:function(e){return t.onCloseForm(o)}}},[n("TMSvgImg",{attrs:{id:"close",size:12}})],1),t.isLoggedIn&&t.unableToComment?n("TMNotice",{attrs:{type:"negative"}},[t._v("\n            "+t._s(t.getCommentAccess.cantCommentReason)+"\n          ")]):n("TMCommentForm",{key:t.commentFormAction+"_form",ref:"replyForm",refInFor:!0,attrs:{autofocus:"true",cols:"30","countdown-timer":t.timer,"initial-data":t.replyFormInitialData,"is-processing":t.isEditCommentFormDisabled||t.isFormDisabled,label:t.getFormLabel(o.comment),readonly:t.isEditCommentFormDisabled||t.isFormDisabled,rows:"5","show-delete":"update"===t.commentFormAction},on:{close:function(e){return t.onCloseForm(o)},delete:function(e){return t.$emit("commentDelete",{value:e,parentId:o.comment.id})},preview:function(e){return t.onReplyCommentPreview({value:e,parentId:o.comment.id})},submit:function(e){return t.onCommentSend({value:e,parentId:o.comment.id})}},model:{value:t.replyFormInitialData,callback:function(e){t.replyFormInitialData=e},expression:"replyFormInitialData"}})],1)]):t._e()]}}],null,!0)})})),t.popupTargetCommentWrapper?n("TMCommentPopup",{attrs:{"can-send-complaint":Boolean(t.complaintAction),comment:t.popupTargetCommentWrapper.comment,"comment-editable":t.commentEditable,"comment-link":t.getCommentLink?t.getCommentLink(t.popupTargetCommentWrapper.comment):null,target:t.popupTargetElement},on:{close:t.closePopup,collapseBranch:function(e){t.toggleCollapse(t.popupTargetCommentWrapper),t.closePopup()},enterEditMode:function(e){return t.showEditForm(t.popupTargetCommentWrapper.comment)},linkCopied:t.closePopup,sendComplaint:function(e){t.showComplaintForm(t.popupTargetCommentWrapper),t.closePopup()}}}):t._e()],2)},O=[],T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("TMContextMenu",{attrs:{target:t.target},on:{close:function(e){return t.$emit("close")}},scopedSlots:t._u([{key:"body",fn:function(){return[n("ul",{staticClass:"tm-comment-popup"},[!t.isTablet&&t.isMobile&&t.comment.level>0&&t.comment.children.length?n("li",{staticClass:"tm-comment-popup__comment-menu-item"},[n("button",{staticClass:"tm-comment-popup__button",on:{click:function(e){return t.$emit("collapseBranch")}}},[n("TMSvgImg",{staticClass:"tm-comment-popup__comment-menu-icon",attrs:{id:"collapse",size:"24"}}),n("span",{staticClass:"tm-comment-popup__comment-menu-handler"},[t._v("\n            "+t._s(t.msg("COMMENT_ACTION_COLLAPSE_BRANCH"))+"\n          ")])],1)]):t._e(),t.commentLink?n("li",{staticClass:"tm-comment-popup__comment-menu-item"},[n("button",{staticClass:"tm-comment-popup__button",on:{click:function(e){return t.copyLink(t.comment)}}},[n("TMSvgImg",{staticClass:"tm-comment-popup__comment-menu-icon",attrs:{id:"copy",size:"24"}}),n("span",{staticClass:"tm-comment-popup__comment-menu-handler"},[t._v("\n            "+t._s(t.msg("COMMENT_ACTION_COPY_LINK"))+"\n          ")])],1)]):t._e(),t.commentEditable?n("li",{staticClass:"tm-comment-popup__comment-menu-item"},[t.isSuperAdmin&&1===t.comment.editorVersion?n("a",{staticClass:"tm-comment-popup__external-link",attrs:{href:t.getCp2EditFormLink(t.comment.id),target:"_blank"}},[n("TMSvgImg",{staticClass:"tm-comment-popup__comment-menu-icon",attrs:{id:"pencil",size:"24"}}),n("span",{staticClass:"tm-comment-popup__comment-menu-handler"},[t._v("\n            "+t._s(t.msg("COMMENT_ACTION_EDIT"))+"\n          ")])],1):n("button",{staticClass:"tm-comment-popup__button",on:{click:function(e){return t.$emit("enterEditMode")}}},[n("TMSvgImg",{staticClass:"tm-comment-popup__comment-menu-icon",attrs:{id:"pencil",size:"24"}}),n("span",{staticClass:"tm-comment-popup__comment-menu-handler"},[t._v("\n            "+t._s(t.msg("COMMENT_ACTION_EDIT"))+"\n          ")])],1)]):t._e(),t.canSendComplaint&&!t.comment.isSuspended?n("li",{staticClass:"tm-comment-popup__comment-menu-item"},[n("button",{staticClass:"tm-comment-popup__button",on:{click:function(e){return t.$emit("sendComplaint")}}},[n("TMSvgImg",{staticClass:"tm-comment-popup__comment-menu-icon",attrs:{id:"report",size:"24",title:t.msg("COMMENT_COMPLAINT_TITLE")}}),n("span",{staticClass:"tm-comment-popup__comment-menu-handler"},[t._v("\n            "+t._s(t.msg("COMMENT_COMPLAINT_TITLE"))+"\n          ")])],1)]):t._e()])]},proxy:!0}])})},F=[],w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return!t.isTablet&&t.isMobile?n("TMScrollLockTransition",{attrs:{appear:"",name:"slide-fade"}},[n("TMBottomSheet",{on:{close:function(e){return t.$emit("close")}},scopedSlots:t._u([{key:"default",fn:function(){return[t._t("default")]},proxy:!0},{key:"body",fn:function(){return[t._t("body")]},proxy:!0}],null,!0)})],1):n("transition",{attrs:{appear:"",name:"transition-fade"}},[n("TMPopover",{attrs:{root:t.target,variant:"dropdown"},on:{close:function(e){return t.$emit("close")}}},[t._t("default"),t._t("body")],2)],1)},S=[],I=n("12c3"),E=n("3cb0"),M=n("1a5d");function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){j(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var A={name:"TMContextMenu",components:{TMPopover:E["a"],TMBottomSheet:I["a"],TMScrollLockTransition:M["a"]},props:{target:{type:null,required:!0}},computed:W({},Object(a["c"])("global",["isMobile","isTablet"]))},k=A,N=Object(_["a"])(k,w,S,!1,null,null,null),L=N.exports,$=n("b7d0"),D=n("1fa6");function Y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(n),!0).forEach((function(e){B(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var R={name:"TMCommentPopup",components:{TMContextMenu:L,TMSvgImg:$["a"]},props:{comment:{type:Object,required:!0},commentLink:{type:String,default:null},commentEditable:{type:Boolean,default:!1},canSendComplaint:{type:Boolean,default:!1},target:{type:null,required:!0}},computed:x(x({},Object(a["c"])("global",["isMobile","isTablet"])),Object(a["c"])("me",["isSuperAdmin"])),methods:{copyLink:function(){try{Object(D["a"])(this.commentLink),this.$toast.success(this.msg("COMMENT_NOTICE_COPY_LINK_SUCCESS"))}catch(t){this.$toast.error(this.msg("COMMENT_NOTICE_COPY_LINK_ERROR"))}this.$emit("linkCopied")},getCp2EditFormLink:function(t){return"/kek/admin/comments_edit/?id=".concat(t)}}},V=R,H=(n("26d6"),Object(_["a"])(V,T,F,!1,null,null,null)),G=H.exports,U=function(t,e){var n=e._c;return n("section",{staticClass:"tm-comment tm-comment-thread-functional",class:{"tm-comment__is-deleted":e.props.commentWrapper.comment.isSuspended},attrs:{"data-first-unread":e.props.firstUnreadId===e.props.commentWrapper.comment.id}},[e.props.commentWrapper.isChildrenVisible?e._e():n("div",{staticClass:"tm-comment-thread-functional__collapsed-root",attrs:{"data-comment-collapsed-thread":""}}),e.props.commentWrapper.isChildrenVisible?e._e():n("div",{staticClass:"tm-comment__breadcrumbs tm-comment__breadcrumbs_collapsed",class:e.props.commentWrapper.indentBreadcrumbsClass,on:{click:function(t){return e.listeners.toggleCollapse(e.props.commentWrapper)}}}),e.props.commentWrapper.isChildrenVisible?e._e():n("div",{staticClass:"tm-comment__collapsed",class:e.props.commentWrapper.indentClass,on:{click:function(t){return e.listeners.toggleCollapse(e.props.commentWrapper)}}},[e._m(0),n("div",{staticClass:"tm-comment__collapsed-text",domProps:{textContent:e._s(e.props.commentWrapper.collapsedText)}}),n("div",{staticClass:"tm-comment__collapsed-line"})]),n(e.$options.components.LazyHydrate,{tag:"component",attrs:{"when-visible":""}},[n("article",{directives:[{name:"show",rawName:"v-show",value:e.props.commentWrapper.isChildrenVisible,expression:"props.commentWrapper.isChildrenVisible"}],staticClass:"tm-comment-thread-functional__comment"},[n("a",{staticClass:"tm-comment-thread-functional__target",attrs:{"data-comment-new":e.props.commentWrapper.comment.isNew,name:"comment_"+e.props.commentWrapper.comment.id}}),e.props.commentWrapper.isChildrenVisible&&e.props.commentWrapper.comment.author?n("div",{staticClass:"tm-comment__breadcrumbs",class:e.props.commentWrapper.indentBreadcrumbsClass,on:{click:function(t){return e.listeners.toggleCollapse(e.props.commentWrapper)}}},[n("div",{staticClass:"tm-comment__circle"})]):e._e(),e.props.commentWrapper.comment.author?e._e():n("span",{staticClass:"tm-comment__ufo",class:e.props.commentWrapper.indentClass,domProps:{textContent:e._s(e.props.placeholderText)}}),e.props.commentWrapper.comment.author?[n("div",{class:e.props.commentWrapper.indentClass,attrs:{"data-comment-body":e.props.commentWrapper.comment.id}},[n(e.props.commentComponent||e.$options.components.TMComment,{tag:"component",attrs:{comment:e.props.commentWrapper.comment,"user-popover-enabled":""},scopedSlots:e._u([{key:"comment-link",fn:function(t){var o=t.datetimeStr;return[n("a",{staticClass:"tm-comment-thread-functional__comment-link",attrs:{href:"#comment_"+e.props.commentWrapper.comment.id},on:{click:function(t){return t.preventDefault(),e.$options.methods.navigateToComment(e.props.commentWrapper.comment.id)}}},[e._v("\n                "+e._s(e.props.msg("DATE_FORMAT",o))+"\n\n                "),e.props.commentWrapper.comment.timeChanged?n(e.$options.components.TMSvgImg,{tag:"component",staticClass:"tm-comment-thread-functional__icon-pencil",attrs:{id:"pencil-small",title:e.props.msg("COMMENT_EDITED")}}):e._e()],1)]}}],null,!1,2345123377)}),e.props.commentWrapper.shouldShowFooterButtons?n(e.$options.components.TMCommentFooter,{tag:"component",attrs:{comment:e.props.commentWrapper.comment,"favorite-action":e.props.favoriteAction,"popup-toggle-visible":e.props.commentWrapper.popupEnabled,"vote-action":e.props.voteAction},on:{onModerate:function(t){return e.listeners.moderate({commentWrapper:e.props.commentWrapper,isApprove:t})},openPopup:function(t){return e.listeners.openPopup(e.props.commentWrapper)},showComplaintForm:function(t){return e.listeners.showComplaintForm(e.props.commentWrapper)}},scopedSlots:e._u([{key:"button",fn:function(){return[n("button",{staticClass:"tm-comment-thread-functional__button",attrs:{type:"button"},on:{click:function(t){return e.listeners.showReplyForm(e.props.commentWrapper)}}},[e._v("\n                "+e._s(e.props.msg("COMMENT_ACTION_REPLY"))+"\n              ")])]},proxy:!0}],null,!1,2255592405)}):e._e()],1),e._t("body",null,{commentWrapper:e.props.commentWrapper})]:e._e()],2)]),0!==e.props.commentWrapper.children.length?[n("div",{directives:[{name:"show",rawName:"v-show",value:e.props.commentWrapper.isChildrenVisible,expression:"props.commentWrapper.isChildrenVisible"}],staticClass:"tm-comment-thread-functional__children"},e._l(e.props.commentWrapper.children,(function(t){return n("TMCommentThreadFunctional",e._g(e._b({key:t.comment.id,tag:"component",attrs:{"comment-wrapper":t},scopedSlots:e._u([{key:"body",fn:function(t){var n=t.commentWrapper;return[e._t("body",null,{commentWrapper:n})]}}],null,!0)},"component",e.props,!1),e.listeners))})),1)]:e._e()],2)},q=[function(t,e){var n=e._c;return n("div",{staticClass:"tm-comment__circle-block"},[n("div",{staticClass:"tm-comment__circle tm-comment__circle_active"})])}],z=new Map;function K(t){if("undefined"===typeof IntersectionObserver)return null;var e=JSON.stringify(t);if(z.has(e))return z.get(e);var n=new IntersectionObserver((function(t){t.forEach((function(t){var e=t.isIntersecting||t.intersectionRatio>0;e&&t.target.hydrate&&t.target.hydrate()}))}),t);return z.set(e,n),n}function J(){var t=function(){},e=new Promise((function(e){t=e}));return{hydrate:t,hydrationPromise:e}}var Q="undefined"===typeof window;function X(t){return"function"===typeof t}function Z(t){return X(t)?t().then((function(t){return t.default})):t}function tt(t){var e=t.component,n=t.hydrationPromise;return Q?e:function(){return n.then((function(){return Z(e)}))}}function et(t,e){return Object.assign({mixins:[{beforeCreate:function(){this.cleanupHandlers=[];var e=J(),n=e.hydrate,o=e.hydrationPromise;this.Nonce=tt({component:t,hydrationPromise:o}),this.hydrate=n,this.hydrationPromise=o},beforeDestroy:function(){this.cleanup()},mounted:function(){var t=this;if(this.$el.nodeType!==Node.COMMENT_NODE){if(!this.never){if(this.whenVisible){var e=!0!==this.whenVisible?this.whenVisible:void 0,n=K(e);if(!n)return void this.hydrate();this.$el.hydrate=this.hydrate;var o=function(){return n.unobserve(t.$el)};return this.cleanupHandlers.push(o),this.hydrationPromise.then(o),void n.observe(this.$el)}if(this.whenIdle){if(!("requestIdleCallback"in window)||!("requestAnimationFrame"in window))return void this.hydrate();var r=requestIdleCallback((function(){requestAnimationFrame(t.hydrate)}),{timeout:this.idleTimeout}),i=function(){return cancelIdleCallback(r)};this.cleanupHandlers.push(i),this.hydrationPromise.then(i)}if(this.interactionEvents&&this.interactionEvents.length){var m={capture:!0,once:!0,passive:!0};this.interactionEvents.forEach((function(e){t.$el.addEventListener(e,t.hydrate,m);var n=function(){t.$el.removeEventListener(e,t.hydrate,m)};t.cleanupHandlers.push(n)}))}}}else this.hydrate()},methods:{cleanup:function(){this.cleanupHandlers.forEach((function(t){return t()}))}},render:function(t){return t(this.Nonce,{attrs:this.$attrs,on:this.$listeners,scopedSlots:this.$scopedSlots},this.$slots.default)}}]},e)}var nt={render:function(){return this.$slots.default}},ot=et(nt,{props:{idleTimeout:{default:2e3,type:Number},never:{type:Boolean},onInteraction:{type:[Array,Boolean,String]},triggerHydration:{default:!1,type:Boolean},whenIdle:{type:Boolean},whenVisible:{type:[Boolean,Object]}},computed:{interactionEvents:function(){return this.onInteraction?!0===this.onInteraction?["focus"]:Array.isArray(this.onInteraction)?this.onInteraction:[this.onInteraction]:[]}},watch:{triggerHydration:{immediate:!0,handler:function(t){t&&this.hydrate()}}}}),rt=ot,it=n("da18"),mt=n("c499"),st=n("79f0"),at=n("5d2c"),ct={name:"TMCommentThreadFunctional",components:{TMComment:st["a"],TMCommentFooter:mt["a"],LazyHydrate:rt,TMSvgImg:$["a"]},props:{commentComponent:{type:Object,default:null},commentWrapper:{type:Object,required:!0},collapsedText:{type:String,default:null},placeholderText:{type:String,default:null},isAuthorized:{type:Boolean,default:!1},msg:{type:Function,required:!0},voteAction:{type:Function,default:null},favoriteAction:{type:Function,default:null},firstUnreadId:{type:[String,Number],default:null}},methods:{navigateToComment:function(t){var e="#comment_".concat(t);Object(at["c"])(e).then((function(){return Object(it["a"])(e)}))}}},lt=ct,ut=(n("bb6f"),Object(_["a"])(lt,U,q,!0,null,null,null)),pt=ut.exports,dt=n("e314"),ft=n("e4d1"),ht=n("badd"),bt=n("0a5f");function Ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function _t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ct(Object(n),!0).forEach((function(e){gt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vt={name:"TMCommentThread",components:{TMSvgImg:$["a"],TMPopup:ht["a"],TMCommentForm:v,TMNotice:ft["a"],TMComment:st["a"],TMComplaintForm:dt["a"],TMCommentThreadFunctional:pt,TMCommentPopup:G},props:{comments:{required:!0,type:Array},commentComponent:{type:Object,default:null},voteAction:{type:Function,default:null},favoriteAction:{type:Function,default:null},complaintAction:{type:Function,default:null},getCommentLink:{type:Function,default:null},inStorage:{type:Array,default:null}},data:function(){return{isEditCommentFormDisabled:!1,commentFormAction:null,replyFormInitialData:null,complaintFormValue:"",counter:!1,timer:0,interval:null,childrenHiddenFor:[],popupTargetCommentWrapper:null,commentFormFor:null,complaintFormTarget:null,isProcessingComplaintForm:!1,complaintFormFor:null,firstUnreadId:null}},computed:_t(_t(_t(_t(_t(_t({},Object(a["e"])("comments",["commentsListV2","isFormDisabled","commentWithOpenedForm"])),Object(a["c"])("comments",["getCommentById","getPreviewComment"])),Object(a["c"])("me",["userAlias","isLoggedIn","isSuperAdmin"])),Object(a["e"])("comments",["isFormDisabled","commentWithOpenedForm"])),Object(a["c"])("comments",["getScrollParents","getCommentAccess"])),{},{unableToComment:function(){return!(!this.getCommentAccess||"boolean"!==typeof this.getCommentAccess.isCanComment)&&!this.getCommentAccess.isCanComment},canSendComplaint:function(){return this.user&&this.user.settings.permissionSettings.canAddComplaints||this.isSuperAdmin},useNewWYSIWYG:function(){return!0},commentEditable:function(){return this.getIsCommentEditable(this.popupTargetCommentWrapper.comment)},popupTargetElement:function(){var t=this.popupTargetCommentWrapper||{},e=t.comment;if(!e)return null;var n=e.id;return document.querySelector('[data-comment-popup="'.concat(n,'"]'))},wrappedComments:function(){var t=this.msg,e=this.comments,n=this.getCountHiddenComments,o=this.getIndentClass,r=this.getIndentBreadcrumbsClass,i=this.getShouldShowFooterButtons,m=this.getVotesLeverAccess,s=this.childrenHiddenFor,a=this.getPopupEnabled;return e.map((function e(c){return{comment:c,children:Array.from(c.children).map(e),isChildrenVisible:-1===s.indexOf(c.id),collapsedText:t("COMMENT_COLLAPSED",{count:n(c)}),indentClass:o(c),indentBreadcrumbsClass:r(c),shouldShowFooterButtons:i(c),shouldShowVotesLever:m(c),popupEnabled:a(c)}}))}}),mounted:function(){var t=this.inStorage,e=[];if(this.wrappedComments.forEach((function n(o){t&&t.length>0&&-1!==t.indexOf(o.comment.id)&&(o.comment.isChildrenVisible=!1),o.comment.isNew&&e.push(o.comment.id),o.children.map(n)})),e.length){var n=e[0];this.firstUnreadId=n}this.setFreshComments(e)},beforeDestroy:function(){this.clearFreshComments(),this.closeForm()},methods:_t(_t({},Object(a["b"])("comments",["closeForm","openForm","clearCommentsList","setFreshComments","clearFreshComments","sendComment","previewComment","updateComment","moderateComment"])),{},{openPopup:function(t){var e=this;this.popupTargetCommentWrapper===t?this.popupTargetCommentWrapper=null:this.popupTargetCommentWrapper?(this.popupTargetCommentWrapper=null,this.$nextTick((function(){e.popupTargetCommentWrapper=t}))):this.popupTargetCommentWrapper=t},closePopup:function(){this.popupTargetCommentWrapper=null},toggleCollapse:function(t){var e=t.comment.id,n=this.childrenHiddenFor.indexOf(e);-1!==n?(this.$emit("deleteFromStorage",e),this.childrenHiddenFor.splice(n,1)):(this.$emit("addToStorage",e),this.childrenHiddenFor.push(e))},getCountHiddenComments:function(t){return t.children.reduce((function t(e,n){var o=n.children;return o.length?o.reduce(t,e+1):e+1}),1)},onAddToStorage:function(t){this.$emit("addToStorage",t)},onDeleteFromStorage:function(t){this.$emit("deleteFromStorage",t)},moderateReadAndComment:function(t){var e=t.commentWrapper,n=t.isApprove;return this.moderateComment({isApprove:n,commentId:e.comment.id,postId:this.$route.params.id})},onCloseForm:function(){this.commentFormFor=null,this.closeForm(),clearInterval(this.interval)},onCommentSend:function(t){var e=this;"update"!==this.commentFormAction?this.$emit("commentSubmit",t):this.onEditComment(t).catch((function(t){e.$toast.error(t.message)}))},onComplaintSend:function(t){var e=this;this.isProcessingComplaintForm=!0,this.complaintAction(t).then((function(){e.hideComplaintForm(),e.$emit("submitComplaintForm",t),e.isProcessingComplaintForm=!1}))},onReplyCommentPreview:function(t){this.$emit("previewReplyComment",t)},onReplyCommentSuspend:function(t){this.$emit("suspendReplyComment",t)},onEditComment:function(t){var e=this,n=t.parentId,o=this.$route.params.id,r={isMarkdown:!0,text:t.value,parentId:t.parentId,timestamp:(new Date).getTime()};return this.isEditCommentFormDisabled=!0,Object(bt["e"])(o,n,r).then((function(t){e.isEditCommentFormDisabled=!1,e.updateComment(t.data.comment),e.onCloseForm()})).catch((function(t){throw e.isEditCommentFormDisabled=!1,e.$toast.error(t.message),t}))},showComplaintForm:function(t){this.commentFormFor=null,this.complaintFormTarget=t.comment.id,this.complaintFormValue="",this.openForm(t.comment)},hideComplaintForm:function(){this.commentFormFor=null,this.complaintFormTarget=null,this.complaintFormValue="",this.closeForm()},showReplyForm:function(t){this.isLoggedIn?(this.commentFormFor=t.comment.id,this.complaintFormTarget=null,this.commentFormAction="reply",this.replyFormInitialData=null,this.openForm(t.comment)):this.$toast.error(this.msg("AUTH_REQUIRED"))},showEditForm:function(t){var e=this,n=t.id,o=this.$route.params.id;return Object(bt["g"])(o,n).then((function(o){var r=o.sourceMessage;e.replyFormInitialData=r,e.commentFormFor=n,e.commentFormAction="update",e.closePopup(),e.openForm(t),e.$nextTick((function(){Object(c["b"])(e.$refs.replyForm[0].$el)})),e.startTimer(t)})).catch((function(t){return e.$toast.error(t.message)}))},startTimer:function(t){var e=new Date(t.timeEditAllowedTill);this.timer=Math.trunc((e-new Date)/1e3),clearInterval(this.interval),this.interval=setInterval(this.countDown,1e3)},countDown:function(){this.counter?this.timer>0?this.timer-=1:(clearInterval(this.interval),this.timer=null,this.counter=!1):this.counter=!0},getIndentClass:function(t){var e=10,n=Math.min(t.level,e);return"tm-comment__indent_l-".concat(n)},getFormLabel:function(t){switch(this.commentFormAction){case"reply":return"".concat(this.msg("COMMENT_ACTION_REPLY"),'&nbsp;<span class="tm-username">').concat(t.author.alias||t.author.login,"</span>");case"update":return this.msg("COMMENT_EDIT_FORM_TITLE");default:return null}},getIndentBreadcrumbsClass:function(t){var e=10,n=Math.min(t.level,e);return"tm-comment__indent_b_l-".concat(n)},getShouldShowFooterButtons:function(t){var e=t.id;return!t.isSuspended&&this.commentWithOpenedForm!==e},getShouldShowCommentForm:function(t){var e=t.comment,n=e.id,o=e.isSuspended,r=e.userDeactivated;return this.commentFormFor===n&&!o&&this.commentWithOpenedForm===n&&1!==r},getShouldShowComplaintForm:function(t){var e=t.comment.id;return this.complaintFormTarget===e&&this.commentWithOpenedForm===e},getVotesLeverAccess:function(t){var e=t&&t.vote&&t.vote.isCanVote;return this.isLoggedIn&&e&&1!==t.userDeactivated},getIsCommentEditable:function(t){return t.isCanEdit&&!t.isSuspended},getPopupEnabled:function(t){return Boolean(this.complaintAction||this.getCommentLink||this.getIsCommentEditable(t)||t.level>0&&t.children.length)}})},yt=vt,Ot=(n("8e36"),Object(_["a"])(yt,y,O,!1,null,null,null)),Tt=Ot.exports,Ft=n("6833"),wt=n("5188"),St={name:"TMComments",components:{TMCommentForm:v,TMNotice:ft["a"],TMCommentThread:Tt,TMEmptyPlaceholder:Ft["a"],TMPlaceholder:wt["a"]},props:{comments:{type:Array,default:null},commentComponent:{type:Object,default:null},commentsCount:{type:[Number,String],default:null},inStorage:{type:Array,default:null},isLoading:{type:Boolean,default:!1},notice:{type:Object,default:null},voteAction:{type:Function,default:null},favoriteAction:{type:Function,default:null},complaintAction:{type:Function,default:null},rootCommentingEnabled:{type:Boolean,default:!1},isProcessingForm:{type:Boolean,default:!1},getCommentLink:{type:Function,default:null}}},It=St,Et=(n("be6e"),Object(_["a"])(It,o,r,!1,null,null,null));e["a"]=Et.exports},"1dfa":function(t,e,n){},"26d6":function(t,e,n){"use strict";n("1dfa")},"3fbf":function(t,e,n){"use strict";n("9115")},"4b37":function(t,e,n){},"629d":function(t,e,n){},"69ac":function(t,e,n){},"8e36":function(t,e,n){"use strict";n("69ac")},9115:function(t,e,n){},bb6f:function(t,e,n){"use strict";n("629d")},be6e:function(t,e,n){"use strict";n("4b37")},c551:function(t,e,n){"use strict";n.d(e,"f",(function(){return i})),n.d(e,"d",(function(){return m})),n.d(e,"e",(function(){return s})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return c})),n.d(e,"c",(function(){return u}));var o=n("2105"),r=n("4dcc");function i(){return Object(o["b"])(Object(r["a"])("publication/wysiwyg-rules","v2"))}function m(t){return Object(o["b"])(Object(r["a"])("publication/suggest-tags","v2"),t)}function s(t){return Object(o["c"])(Object(r["a"])("publication/upload","v2"),t)}function a(t,e){var n=e?"publication/save/".concat(e):"publication/save";return Object(o["c"])(Object(r["a"])(n,"v2"),t)}function c(t){return Object(o["b"])(Object(r["a"])("publication/post-data/".concat(t),"v2"))}var l=function(t,e){return t.filter((function(t){return-1===e.indexOf(t.id)})).map((function(t){return{name:t.title,alias:t.id.toString()}}))};function u(t){return Object(o["b"])(Object(r["a"])("publication/suggest-hubs","v2"),t).then((function(t){var e=[],n=t.byPost?t.byPost.map((function(t){return e.push(t.id),{name:t.title,alias:t.id.toString()}})):[],o=t.collective?l(t.collective,e):[],r=t.corporative?l(t.corporative,e):[],i=t.offtopic?l(t.offtopic,e):[];return[{list:n,name:"PUBLICATION_HUBS_BYPOST"},{list:r,name:"PUBLICATION_HUBS_CORPORATIVE"},{list:o,name:"PUBLICATION_HUBS_COLLECTIVE"},{list:i,name:"PUBLICATION_HUBS_OFFTOPIC"}]}))}}}]);
//# sourceMappingURL=chunk-8112ba00.89eac754.js.map